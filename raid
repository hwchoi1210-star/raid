<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê¸¸ë“œ ë ˆì´ë“œ íŒŒí‹° ì¼ì •</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #1c1c2e;
  color: #fff;
  padding: 20px;
}
h1 { color: #ffa500; }

input, select, button {
  padding: 6px;
  margin: 5px;
  font-size: 1em;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  table-layout: fixed;
}

th, td {
  border: 1px solid #555;
  padding: 12px;
  text-align: center;
  vertical-align: middle;
  word-wrap: break-word;
}

th { background-color: #333; }
tr:nth-child(even) { background-color: #2e2e3e; }

.join-btn {
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  padding: 6px 12px;
  font-size: 0.9em;
}

.delete-btn {
  background-color: #ff4444;
  color: white;
  border: none;
  cursor: pointer;
  padding: 6px 12px;
  font-size: 0.9em;
}

.leave-btn {
  background-color: #ff9444;
  color: #222;
  border: none;
  cursor: pointer;
  padding: 2px 6px;
  margin-left: 5px;
  font-size: 0.8em;
  border-radius: 4px;
}

.user-inputs label { margin-left: 10px; }

.participants-list {
  text-align: left;
  display: grid;
  grid-template-columns: 1fr; /* 1ì—´ë¡œ ë³€ê²½ */
  grid-auto-rows: auto;
  gap: 4px 0;
}

.participant {
  display: flex;
  align-items: center;
  gap: 5px;
  background-color: #3a3a5a;
  padding: 2px 4px;
  border-radius: 4px;
  color: #fff;
  font-size: 0.9em;
}
</style>
</head>
<body>
<h1>ğŸ”¥ ê¸¸ë“œ ë ˆì´ë“œ íŒŒí‹° ì¼ì •</h1>

<div class="user-inputs">
  <label>ë‹‰ë„¤ì„:</label>
  <input type="text" id="userName" placeholder="ë‚´ ë‹‰ë„¤ì„" />
  <label>ë ˆë²¨:</label>
  <input type="number" id="userLevel" placeholder="ë ˆë²¨" min="1" max="1700" />
  <label>ì—­í• êµ°:</label>
  <select id="userRole">
    <option value="ë”œëŸ¬">ë”œëŸ¬</option>
    <option value="ì„œí¿">ì„œí¿</option>
  </select>
  <label>ì§ì—…:</label>
  <select id="userJob"></select>
</div>

<div>
  <label>ë ˆì´ë“œ ì¢…ë¥˜:</label>
  <select id="raidCategory" onchange="onRaidCategoryChange()">
    <optgroup label="êµ°ë‹¨ì¥ ë ˆì´ë“œ">
      <option value="ë°œíƒ„">ë°œíƒ„</option>
      <option value="ë¹„ì•„í‚¤ìŠ¤">ë¹„ì•„í‚¤ìŠ¤</option>
      <option value="ì¿ í¬ì„¸ì´íŠ¼">ì¿ í¬ì„¸ì´íŠ¼</option>
      <option value="ì•„ë¸Œë ìŠˆë“œ">ì•„ë¸Œë ìŠˆë“œ</option>
    </optgroup>
    <optgroup label="ë˜ì „">
      <option value="ì¹´ì–‘ê²”">ì¹´ì–‘ê²”</option>
      <option value="ìƒì•„íƒ‘">ìƒì•„íƒ‘</option>
    </optgroup>
    <optgroup label="ì¹´ì œë¡œìŠ¤ ë ˆì´ë“œ">
      <option value="ë² íˆëª¨ìŠ¤">ë² íˆëª¨ìŠ¤</option>
      <option value="ì„œë§‰">ì„œë§‰</option>
      <option value="1ë§‰">1ë§‰</option>
      <option value="2ë§‰">2ë§‰</option>
      <option value="3ë§‰">3ë§‰</option>
      <option value="4ë§‰">4ë§‰</option>
      <option value="ì¢…ë§‰">ì¢…ë§‰</option>
      <option value="80ë…¸ë…¸í•˜">80ë…¸ë…¸í•˜</option>
    </optgroup>
  </select>

  <label>ë‚œì´ë„:</label>
  <select id="difficulty">
    <option value="ë…¸ë§">ë…¸ë§</option>
    <option value="í•˜ë“œ">í•˜ë“œ</option>
    <option value="í—¬">í—¬</option>
  </select>

  <label>ë‚ ì§œ:</label>
  <input type="date" id="raidDate" />
  <label>ì‹œê°„:</label>
  <input type="time" id="raidTime" />
  <button onclick="createRaid()">ë ˆì´ë“œ ìƒì„±</button>
</div>

<table>
  <thead>
    <tr>
      <th>ë ˆì´ë“œ</th>
      <th>ë‚œì´ë„</th>
      <th>ë‚ ì§œ</th>
      <th>ì‹œê°„</th>
      <th>ì°¸ì—¬ì</th>
      <th>ì°¸ì—¬</th>
      <th>íŒŒí‹° í•´ì²´</th>
    </tr>
  </thead>
  <tbody id="raidTableBody"></tbody>
</table>

<script>
const allJobs = ["ë²„ì„œì»¤","ë””ìŠ¤íŠ¸ë¡œì´ì–´","ì›Œë¡œë“œ","í™€ë¦¬ë‚˜ì´íŠ¸","ê±´ìŠ¬ë§ì–´","ë°ë¹Œí—Œí„°","í˜¸í¬ì•„ì´","ìŠ¤ì¹´ìš°í„°","ë¸”ë˜ìŠ¤í„°","ì†Œì„œë¦¬ìŠ¤","ì„œë¨¸ë„ˆ","ì•„ë¥´ì¹´ë‚˜","ë°”ë“œ","ê¸°ê³µì‚¬","ì¸íŒŒì´í„°","ì°½ìˆ ì‚¬","ë°°í‹€ë§ˆìŠ¤í„°","ê²©íˆ¬ê°€","ë„í™”ê°€","ë¦¬í¼","ì†Œìš¸ì´í„°","ë°œí‚¤ë¦¬","ìš©ê¸°ì‚¬","í™˜ìˆ˜ì‚¬","ê¸°ìƒìˆ ì‚¬","ìŠ¬ë ˆì´ì–´"];
const supportJobs = ["ë°œí‚¤ë¦¬","ë°”ë“œ","ë„í™”ê°€","í™€ë¦¬ë‚˜ì´íŠ¸"];

const roleSelect = document.getElementById("userRole");
const jobSelect = document.getElementById("userJob");
const raidCategorySelect = document.getElementById("raidCategory");
const difficultySelect = document.getElementById("difficulty");
const raidTableBody = document.getElementById("raidTableBody");

function updateJobOptions(){
  const selectedRole = roleSelect.value;
  const jobs = selectedRole==="ì„œí¿"?supportJobs:allJobs;
  jobSelect.innerHTML=`<option value="">ì§ì—… ì„ íƒ</option>`;
  jobs.forEach(job=>{
    const option=document.createElement("option");
    option.value=job; option.textContent=job;
    jobSelect.appendChild(option);
  });
}
roleSelect.addEventListener("change",updateJobOptions);
window.onload=()=>{ updateJobOptions(); loadRaids(); };

function onRaidCategoryChange(){
  const selected=raidCategorySelect.value;
  if(selected==="80ë…¸ë…¸í•˜"){ difficultySelect.disabled=true; difficultySelect.value=""; }
  else{ difficultySelect.disabled=false; if(!difficultySelect.value) difficultySelect.value="ë…¸ë§"; }
}

function getKoreanDayName(dateStr){ const days=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; return days[new Date(dateStr).getDay()]; }

function loadRaids(){
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  const now=new Date();
  const filtered=raids.filter(r=>{ const target=new Date(`${r.date}T${r.time}`); return now<(target.getTime()+60*60*1000); });
  filtered.sort((a,b)=>new Date(`${a.date}T${a.time}`)-new Date(`${b.date}T${b.time}`));
  raidTableBody.innerHTML="";
  filtered.forEach((raid,index)=>{
    const displayDate=`${raid.date} (${getKoreanDayName(raid.date)})`;
    const participantsTd=document.createElement("td"); participantsTd.className="participants-list";
    raid.members.forEach(member=>{
      const span=document.createElement("span"); span.className="participant";
      span.textContent=`${member.name}(${member.level}/${member.role}/${member.job})`;
      const leaveBtn=document.createElement("button"); leaveBtn.textContent="íƒˆí‡´"; leaveBtn.className="leave-btn";
      leaveBtn.onclick=()=>leaveRaid(index,member.name);
      span.appendChild(leaveBtn); participantsTd.appendChild(span);
    });
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${raid.name}</td>
      <td>${raid.difficulty||"-"}</td>
      <td>${displayDate}</td>
      <td>${raid.time}</td>
      <td></td>
      <td><button class="join-btn" onclick="joinRaid(${index})">ì°¸ì—¬</button></td>
      <td><button class="delete-btn" onclick="confirmDeleteRaid(${index})">íŒŒí‹° í•´ì²´</button></td>`;
    row.children[4].replaceWith(participantsTd); raidTableBody.appendChild(row);
  });
  localStorage.setItem("raids",JSON.stringify(filtered));
}

// ë ˆì´ë“œ ìƒì„±, ì°¸ì—¬, íƒˆí‡´, ì‚­ì œ í•¨ìˆ˜
function createRaid(){ 
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementById("userRole").value;
  const job=document.getElementById("userJob").value;
  const name=raidCategorySelect.value;
  const difficulty=difficultySelect.disabled?"":difficultySelect.value;
  const date=document.getElementById("raidDate").value;
  const time=document.getElementById("raidTime").value;
  if(!userName||!level||!role||!job||!name||!date||!time){alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!"); return;}
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  raids.push({name,difficulty,date,time,members:[{name:userName,level,role,job}]});
  localStorage.setItem("raids",JSON.stringify(raids)); loadRaids();
}

function joinRaid(index){
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementBy
