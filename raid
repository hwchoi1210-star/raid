<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>길드 레이드 파티 일정</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #1c1c2e;
  color: #fff;
  padding: 20px;
}
h1 { color: #ffa500; }

input, select, button {
  padding: 6px;
  margin: 5px;
  font-size: 1em;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  table-layout: fixed;
}

th, td {
  border: 1px solid #555;
  padding: 12px;
  text-align: center;
  vertical-align: middle;
  word-wrap: break-word;
}

th { background-color: #333; }
tr:nth-child(even) { background-color: #2e2e3e; }

.join-btn {
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  padding: 6px 12px;
  font-size: 0.9em;
}

.delete-btn {
  background-color: #ff4444;
  color: white;
  border: none;
  cursor: pointer;
  padding: 6px 12px;
  font-size: 0.9em;
}

.leave-btn {
  background-color: #ff9444;
  color: #222;
  border: none;
  cursor: pointer;
  padding: 2px 6px;
  margin-left: 5px;
  font-size: 0.8em;
  border-radius: 4px;
}

.user-inputs label { margin-left: 10px; }

.participants-list {
  text-align: left;
  display: grid;
  grid-template-columns: 1fr; /* 1열로 변경 */
  grid-auto-rows: auto;
  gap: 4px 0;
}

.participant {
  display: flex;
  align-items: center;
  gap: 5px;
  background-color: #3a3a5a;
  padding: 2px 4px;
  border-radius: 4px;
  color: #fff;
  font-size: 0.9em;
}
</style>
</head>
<body>
<h1>🔥 길드 레이드 파티 일정</h1>

<div class="user-inputs">
  <label>닉네임:</label>
  <input type="text" id="userName" placeholder="내 닉네임" />
  <label>레벨:</label>
  <input type="number" id="userLevel" placeholder="레벨" min="1" max="1700" />
  <label>역할군:</label>
  <select id="userRole">
    <option value="딜러">딜러</option>
    <option value="서폿">서폿</option>
  </select>
  <label>직업:</label>
  <select id="userJob"></select>
</div>

<div>
  <label>레이드 종류:</label>
  <select id="raidCategory" onchange="onRaidCategoryChange()">
    <optgroup label="군단장 레이드">
      <option value="발탄">발탄</option>
      <option value="비아키스">비아키스</option>
      <option value="쿠크세이튼">쿠크세이튼</option>
      <option value="아브렐슈드">아브렐슈드</option>
    </optgroup>
    <optgroup label="던전">
      <option value="카양겔">카양겔</option>
      <option value="상아탑">상아탑</option>
    </optgroup>
    <optgroup label="카제로스 레이드">
      <option value="베히모스">베히모스</option>
      <option value="서막">서막</option>
      <option value="1막">1막</option>
      <option value="2막">2막</option>
      <option value="3막">3막</option>
      <option value="4막">4막</option>
      <option value="종막">종막</option>
      <option value="80노노하">80노노하</option>
    </optgroup>
  </select>

  <label>난이도:</label>
  <select id="difficulty">
    <option value="노말">노말</option>
    <option value="하드">하드</option>
    <option value="헬">헬</option>
  </select>

  <label>날짜:</label>
  <input type="date" id="raidDate" />
  <label>시간:</label>
  <input type="time" id="raidTime" />
  <button onclick="createRaid()">레이드 생성</button>
</div>

<table>
  <thead>
    <tr>
      <th>레이드</th>
      <th>난이도</th>
      <th>날짜</th>
      <th>시간</th>
      <th>참여자</th>
      <th>참여</th>
      <th>파티 해체</th>
    </tr>
  </thead>
  <tbody id="raidTableBody"></tbody>
</table>

<script>
const allJobs = ["버서커","디스트로이어","워로드","홀리나이트","건슬링어","데빌헌터","호크아이","스카우터","블래스터","소서리스","서머너","아르카나","바드","기공사","인파이터","창술사","배틀마스터","격투가","도화가","리퍼","소울이터","발키리","용기사","환수사","기상술사","슬레이어"];
const supportJobs = ["발키리","바드","도화가","홀리나이트"];

const roleSelect = document.getElementById("userRole");
const jobSelect = document.getElementById("userJob");
const raidCategorySelect = document.getElementById("raidCategory");
const difficultySelect = document.getElementById("difficulty");
const raidTableBody = document.getElementById("raidTableBody");

function updateJobOptions(){
  const selectedRole = roleSelect.value;
  const jobs = selectedRole==="서폿"?supportJobs:allJobs;
  jobSelect.innerHTML=`<option value="">직업 선택</option>`;
  jobs.forEach(job=>{
    const option=document.createElement("option");
    option.value=job; option.textContent=job;
    jobSelect.appendChild(option);
  });
}
roleSelect.addEventListener("change",updateJobOptions);
window.onload=()=>{ updateJobOptions(); loadRaids(); };

function onRaidCategoryChange(){
  const selected=raidCategorySelect.value;
  if(selected==="80노노하"){ difficultySelect.disabled=true; difficultySelect.value=""; }
  else{ difficultySelect.disabled=false; if(!difficultySelect.value) difficultySelect.value="노말"; }
}

function getKoreanDayName(dateStr){ const days=["일","월","화","수","목","금","토"]; return days[new Date(dateStr).getDay()]; }

function loadRaids(){
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  const now=new Date();
  const filtered=raids.filter(r=>{ const target=new Date(`${r.date}T${r.time}`); return now<(target.getTime()+60*60*1000); });
  filtered.sort((a,b)=>new Date(`${a.date}T${a.time}`)-new Date(`${b.date}T${b.time}`));
  raidTableBody.innerHTML="";
  filtered.forEach((raid,index)=>{
    const displayDate=`${raid.date} (${getKoreanDayName(raid.date)})`;
    const participantsTd=document.createElement("td"); participantsTd.className="participants-list";
    raid.members.forEach(member=>{
      const span=document.createElement("span"); span.className="participant";
      span.textContent=`${member.name}(${member.level}/${member.role}/${member.job})`;
      const leaveBtn=document.createElement("button"); leaveBtn.textContent="탈퇴"; leaveBtn.className="leave-btn";
      leaveBtn.onclick=()=>leaveRaid(index,member.name);
      span.appendChild(leaveBtn); participantsTd.appendChild(span);
    });
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${raid.name}</td>
      <td>${raid.difficulty||"-"}</td>
      <td>${displayDate}</td>
      <td>${raid.time}</td>
      <td></td>
      <td><button class="join-btn" onclick="joinRaid(${index})">참여</button></td>
      <td><button class="delete-btn" onclick="confirmDeleteRaid(${index})">파티 해체</button></td>`;
    row.children[4].replaceWith(participantsTd); raidTableBody.appendChild(row);
  });
  localStorage.setItem("raids",JSON.stringify(filtered));
}

// 레이드 생성, 참여, 탈퇴, 삭제 함수
function createRaid(){ 
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementById("userRole").value;
  const job=document.getElementById("userJob").value;
  const name=raidCategorySelect.value;
  const difficulty=difficultySelect.disabled?"":difficultySelect.value;
  const date=document.getElementById("raidDate").value;
  const time=document.getElementById("raidTime").value;
  if(!userName||!level||!role||!job||!name||!date||!time){alert("모든 정보를 입력하세요!"); return;}
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  raids.push({name,difficulty,date,time,members:[{name:userName,level,role,job}]});
  localStorage.setItem("raids",JSON.stringify(raids)); loadRaids();
}

function joinRaid(index){
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementBy
