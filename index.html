<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê¸¸ë“œ ë ˆì´ë“œ íŒŒí‹° ì¼ì •</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #1c1c2e;
  color: #fff;
  padding: 20px;
  font-size: 1.1em;
}

h1 { color: #ffa500; font-size: 2em; }

input, select, button {
  padding: 8px;
  margin: 5px;
  font-size: 1.1em;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  table-layout: fixed;
}

th, td {
  border: 1px solid #555;
  padding: 14px;
  text-align: center;
  vertical-align: middle;
  word-wrap: break-word;
  font-size: 1.2em;
}

th:nth-child(1), td:nth-child(1) { width: 12%; }
th:nth-child(2), td:nth-child(2) { width: 10%; }
th:nth-child(3), td:nth-child(3) { width: 12%; }
th:nth-child(4), td:nth-child(4) { width: 12%; }
th:nth-child(5), td:nth-child(5) { width: 42%; }
th:nth-child(6), td:nth-child(6) { width: 6%; }
th:nth-child(7), td:nth-child(7) { width: 6%; }

th { background-color: #333; }
tr:nth-child(even) { background-color: #2e2e3e; }

.join-btn { background-color: #4CAF50; color: white; border: none; cursor: pointer; padding: 8px 16px; border-radius: 4px; }
.delete-btn { background-color: #ff4444; color: white; border: none; cursor: pointer; padding: 8px 16px; border-radius: 4px; }
.leave-btn { background-color: #ff9444; color: #222; border: none; cursor: pointer; padding: 4px 8px; margin-left: 5px; font-size: 0.9em; border-radius: 4px; }

.user-inputs label { margin-left: 10px; }

.participants-list {
  display: grid;
  grid-template-columns: repeat(2, 1fr); 
  grid-template-rows: repeat(4, 60px);   /* ê° í–‰ ë†’ì´ ê³ ì • */
  gap: 6px 10px;
  text-align: left;
  width: 100%;
}

.participant {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
  background-color: #3a3a5a;
  padding: 8px 10px;    /* íŒ¨ë”© ëŠ˜ë¦¼ */
  border-radius: 4px;
  color: #fff;
  font-size: 1.1em;     /* ê¸€ì”¨ í¬ê¸° í‚¤ì›€ */
  font-weight: bold;     /* ê°•ì¡° */
  word-break: break-word;
  height: 100%;          /* ì¹¸ ë†’ì´ ê½‰ ì±„ìš°ê¸° */
}

@media (max-width: 768px) {
  table, thead, tbody, th, td, tr { display: block; }
  th { text-align: left; }
  td { text-align: left; }
  tr { margin-bottom: 10px; }
  .participants-list { grid-template-columns: 1fr; grid-template-rows: auto; }
}
</style>
</head>
<body>
<h1>ğŸ”¥ ê¸¸ë“œ ë ˆì´ë“œ íŒŒí‹° ì¼ì •</h1>

<div class="user-inputs">
  <label>ë‹‰ë„¤ì„:</label>
  <input type="text" id="userName" placeholder="ë‚´ ë‹‰ë„¤ì„" />
  <label>ë ˆë²¨:</label>
  <input type="number" id="userLevel" placeholder="ë ˆë²¨" min="1" max="1700" />
  <label>ì—­í• êµ°:</label>
  <select id="userRole">
    <option value="ë”œëŸ¬">ë”œëŸ¬</option>
    <option value="ì„œí¿">ì„œí¿</option>
  </select>
  <label>ì§ì—…:</label>
  <select id="userJob"></select>
</div>

<div>
  <label>ë ˆì´ë“œ ì¢…ë¥˜:</label>
  <select id="raidCategory" onchange="onRaidCategoryChange()">
    <optgroup label="êµ°ë‹¨ì¥ ë ˆì´ë“œ">
      <option value="ë°œíƒ„">ë°œíƒ„</option>
      <option value="ë¹„ì•„í‚¤ìŠ¤">ë¹„ì•„í‚¤ìŠ¤</option>
      <option value="ì¿ í¬ì„¸ì´íŠ¼">ì¿ í¬ì„¸ì´íŠ¼</option>
      <option value="ì•„ë¸Œë ìŠˆë“œ">ì•„ë¸Œë ìŠˆë“œ</option>
    </optgroup>
    <optgroup label="ë˜ì „">
      <option value="ì¹´ì–‘ê²”">ì¹´ì–‘ê²”</option>
      <option value="ìƒì•„íƒ‘">ìƒì•„íƒ‘</option>
    </optgroup>
    <optgroup label="ì¹´ì œë¡œìŠ¤ ë ˆì´ë“œ">
      <option value="ë² íˆëª¨ìŠ¤">ë² íˆëª¨ìŠ¤</option>
      <option value="ì„œë§‰">ì„œë§‰</option>
      <option value="1ë§‰">1ë§‰</option>
      <option value="2ë§‰">2ë§‰</option>
      <option value="3ë§‰">3ë§‰</option>
      <option value="4ë§‰">4ë§‰</option>
      <option value="ì¢…ë§‰">ì¢…ë§‰</option>
      <option value="80ë…¸ë…¸í•˜">80ë…¸ë…¸í•˜</option>
    </optgroup>
  </select>

  <label>ë‚œì´ë„:</label>
  <select id="difficulty">
    <option value="ë…¸ë§">ë…¸ë§</option>
    <option value="í•˜ë“œ">í•˜ë“œ</option>
    <option value="í—¬">í—¬</option>
  </select>

  <label>ë‚ ì§œ:</label>
  <input type="date" id="raidDate" />
  <label>ì‹œê°„:</label>
  <input type="time" id="raidTime" />
  <button onclick="createRaid()">ë ˆì´ë“œ ìƒì„±</button>
</div>

<table>
  <thead>
    <tr>
      <th>ë ˆì´ë“œ</th>
      <th>ë‚œì´ë„</th>
      <th>ë‚ ì§œ</th>
      <th>ì‹œê°„</th>
      <th>ì°¸ì—¬ì</th>
      <th>ì°¸ì—¬</th>
      <th>íŒŒí‹° í•´ì²´</th>
    </tr>
  </thead>
  <tbody id="raidTableBody"></tbody>
</table>

<script>
const allJobs = ["ë²„ì„œì»¤","ë””ìŠ¤íŠ¸ë¡œì´ì–´","ì›Œë¡œë“œ","í™€ë¦¬ë‚˜ì´íŠ¸","ê±´ìŠ¬ë§ì–´","ë°ë¹Œí—Œí„°","í˜¸í¬ì•„ì´","ìŠ¤ì¹´ìš°í„°","ë¸”ë˜ìŠ¤í„°","ì†Œì„œë¦¬ìŠ¤","ì„œë¨¸ë„ˆ","ì•„ë¥´ì¹´ë‚˜","ë°”ë“œ","ê¸°ê³µì‚¬","ì¸íŒŒì´í„°","ì°½ìˆ ì‚¬","ë°°í‹€ë§ˆìŠ¤í„°","ê²©íˆ¬ê°€","ë„í™”ê°€","ë¦¬í¼","ì†Œìš¸ì´í„°","ë°œí‚¤ë¦¬","ìš©ê¸°ì‚¬","í™˜ìˆ˜ì‚¬","ê¸°ìƒìˆ ì‚¬","ìŠ¬ë ˆì´ì–´"];
const supportJobs = ["ë°œí‚¤ë¦¬","ë°”ë“œ","ë„í™”ê°€","í™€ë¦¬ë‚˜ì´íŠ¸"];

const roleSelect = document.getElementById("userRole");
const jobSelect = document.getElementById("userJob");
const raidCategorySelect = document.getElementById("raidCategory");
const difficultySelect = document.getElementById("difficulty");
const raidTableBody = document.getElementById("raidTableBody");

function updateJobOptions() {
  const selectedRole = roleSelect.value;
  let jobs = selectedRole === "ì„œí¿" ? supportJobs.slice() : allJobs.slice();
  jobs.sort((a,b)=>a.localeCompare(b,"ko"));
  jobSelect.innerHTML = `<option value="">ì§ì—… ì„ íƒ</option>`;
  jobs.forEach(job=>{
    const option = document.createElement("option");
    option.value = job;
    option.textContent = job;
    jobSelect.appendChild(option);
  });
}
roleSelect.addEventListener("change", updateJobOptions);
window.onload = () => { updateJobOptions(); loadRaids(); };

function onRaidCategoryChange() {
  const selected = raidCategorySelect.value;
  if (selected==="80ë…¸ë…¸í•˜"){difficultySelect.disabled=true; difficultySelect.value="";}
  else {difficultySelect.disabled=false; if(!difficultySelect.value) difficultySelect.value="ë…¸ë§";}
}

function getKoreanDayName(dateStr){ const days=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; return days[new Date(dateStr).getDay()]; }

function loadRaids(){
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  raids.sort((a,b)=>new Date(`${a.date}T${a.time}`)-new Date(`${b.date}T${b.time}`));
  raidTableBody.innerHTML="";
  raids.forEach((raid,index)=>{
    const displayDate = `${raid.date} (${getKoreanDayName(raid.date)})`;
    const participantsTd = document.createElement("td");
    participantsTd.className="participants-list";
    renderParticipants(raid.members, participantsTd);
    const row = document.createElement("tr");
    row.innerHTML=`
      <td>${raid.name}</td>
      <td>${raid.difficulty||"-"}</td>
      <td>${displayDate}</td>
      <td>${raid.time}</td>
      <td></td>
      <td><button class="join-btn" onclick="joinRaid(${index})">ì°¸ì—¬</button></td>
      <td><button class="delete-btn" onclick="confirmDeleteRaid(${index})">íŒŒí‹° í•´ì²´</button></td>`;
    row.children[4].replaceWith(participantsTd);
    raidTableBody.appendChild(row);
  });
  localStorage.setItem("raids", JSON.stringify(raids));
}

function renderParticipants(members, container){
  container.innerHTML = "";
  const dealers = members.filter(m => m.role !== "ì„œí¿").sort((a,b)=>a.name.localeCompare(b.name,"ko"));
  const supports = members.filter(m => m.role === "ì„œí¿").sort((a,b)=>a.name.localeCompare(b.name,"ko"));

  for(let row=0; row<4; row++){
    const first = dealers.shift() || null;
    const second = supports.shift() || dealers.shift() || null;

    container.appendChild(first ? createParticipantSpan(first) : createEmptySpan());
    container.appendChild(second ? createParticipantSpan(second) : createEmptySpan());
  }
}

function createParticipantSpan(member){
  const span=document.createElement("span");
  span.className="participant";
  span.textContent=`${member.name}(${member.level}/${member.role}/${member.job})`;
  const leaveBtn=document.createElement("button");
  leaveBtn.textContent="íƒˆí‡´";
  leaveBtn.className="leave-btn";
  leaveBtn.onclick=()=>{
    const raids=JSON.parse(localStorage.getItem("raids"))||[];
    raids.forEach(r=>{ r.members=r.members.filter(m=>m.name!==member.name); });
    localStorage.setItem("raids",JSON.stringify(raids));
    loadRaids();
  };
  span.appendChild(leaveBtn);
  return span;
}

function createEmptySpan(){
  const span = document.createElement("span");
  span.className = "participant";
  span.style.backgroundColor = "#2e2e3e";
  span.innerHTML = "&nbsp;";
  return span;
}

function createRaid(){
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementById("userRole").value;
  const job=document.getElementById("userJob").value;
  const name=raidCategorySelect.value;
  const difficulty=difficultySelect.disabled?"":difficultySelect.value;
  const date=document.getElementById("raidDate").value;
  const time=document.getElementById("raidTime").value;
  if(!userName||!level||!role||!job||!name||!date||!time){alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!"); return;}
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  raids.push({name,difficulty,date,time,members:[{name:userName,level,role,job}]});
  localStorage.setItem("raids",JSON.stringify(raids));
  loadRaids();
}

function joinRaid(index){
  const userName=document.getElementById("userName").value.trim();
  const level=parseInt(document.getElementById("userLevel").value.trim());
  const role=document.getElementById("userRole").value;
  const job=document.getElementById("userJob").value;
  if(!userName||!level||!role||!job){alert("ë‹‰ë„¤ì„, ë ˆë²¨, ì—­í• êµ°, ì§ì—…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return;}
  const raids=JSON.parse(localStorage.getItem("raids"))||[];
  const raid=raids[index];
  if(raid.members.some(m=>m.name===userName)){alert("ì´ë¯¸ ì°¸ì—¬ì¤‘ì…ë‹ˆë‹¤."); return;}
  if(raid.members.length>=8){alert("ì¸ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤."); return;}
  raid.members.push({name:userName,level,role,job});
  localStorage.setItem("raids",JSON.stringify(raids));
  loadRaids();
}

function confirmDeleteRaid(index){ if(confirm("í•´ë‹¹ ë ˆì´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) deleteRaid(index);}
function deleteRaid(index){ const raids=JSON.parse(localStorage.getItem("raids"))||[]; raids.splice(index,1); localStorage.setItem("raids",JSON.stringify(raids)); loadRaids();}
</script>
</body>
</html>
